(function(v,m){typeof exports=="object"&&typeof module<"u"?m(exports):typeof define=="function"&&define.amd?define(["exports"],m):(v=typeof globalThis<"u"?globalThis:v||self,m(v.EpicEngine={}))})(this,function(v){"use strict";var m=1e-6,y=typeof Float32Array<"u"?Float32Array:Array,C=Math.random;Math.hypot||(Math.hypot=function(){for(var e=0,r=arguments.length;r--;)e+=arguments[r]*arguments[r];return Math.sqrt(e)});function S(){var e=new y(16);return y!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function fe(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function L(e,r,t){var n=t[0],i=t[1],a=t[2],s,c,h,f,o,l,d,u,g,M,p,A;return r===e?(e[12]=r[0]*n+r[4]*i+r[8]*a+r[12],e[13]=r[1]*n+r[5]*i+r[9]*a+r[13],e[14]=r[2]*n+r[6]*i+r[10]*a+r[14],e[15]=r[3]*n+r[7]*i+r[11]*a+r[15]):(s=r[0],c=r[1],h=r[2],f=r[3],o=r[4],l=r[5],d=r[6],u=r[7],g=r[8],M=r[9],p=r[10],A=r[11],e[0]=s,e[1]=c,e[2]=h,e[3]=f,e[4]=o,e[5]=l,e[6]=d,e[7]=u,e[8]=g,e[9]=M,e[10]=p,e[11]=A,e[12]=s*n+o*i+g*a+r[12],e[13]=c*n+l*i+M*a+r[13],e[14]=h*n+d*i+p*a+r[14],e[15]=f*n+u*i+A*a+r[15]),e}function le(e,r,t){var n=Math.sin(t),i=Math.cos(t),a=r[0],s=r[1],c=r[2],h=r[3],f=r[4],o=r[5],l=r[6],d=r[7];return r!==e&&(e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[0]=a*i+f*n,e[1]=s*i+o*n,e[2]=c*i+l*n,e[3]=h*i+d*n,e[4]=f*i-a*n,e[5]=o*i-s*n,e[6]=l*i-c*n,e[7]=d*i-h*n,e}function de(e,r,t,n,i){var a=1/Math.tan(r/2),s;return e[0]=a/t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==1/0?(s=1/(n-i),e[10]=(i+n)*s,e[14]=2*i*n*s):(e[10]=-1,e[14]=-2*n),e}var ue=de;function ve(e,r,t,n){var i,a,s,c,h,f,o,l,d,u,g=r[0],M=r[1],p=r[2],A=n[0],ae=n[1],se=n[2],ce=t[0],he=t[1],oe=t[2];return Math.abs(g-ce)<m&&Math.abs(M-he)<m&&Math.abs(p-oe)<m?fe(e):(o=g-ce,l=M-he,d=p-oe,u=1/Math.hypot(o,l,d),o*=u,l*=u,d*=u,i=ae*d-se*l,a=se*o-A*d,s=A*l-ae*o,u=Math.hypot(i,a,s),u?(u=1/u,i*=u,a*=u,s*=u):(i=0,a=0,s=0),c=l*s-d*a,h=d*i-o*s,f=o*a-l*i,u=Math.hypot(c,h,f),u?(u=1/u,c*=u,h*=u,f*=u):(c=0,h=0,f=0),e[0]=i,e[1]=c,e[2]=o,e[3]=0,e[4]=a,e[5]=h,e[6]=l,e[7]=0,e[8]=s,e[9]=f,e[10]=d,e[11]=0,e[12]=-(i*g+a*M+s*p),e[13]=-(c*g+h*M+f*p),e[14]=-(o*g+l*M+d*p),e[15]=1,e)}function z(){var e=new y(3);return y!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function me(e){var r=new y(3);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r}function D(e){var r=e[0],t=e[1],n=e[2];return Math.hypot(r,t,n)}function pe(e,r,t){var n=new y(3);return n[0]=e,n[1]=r,n[2]=t,n}function ge(e,r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],e}function Me(e,r,t,n){return e[0]=r,e[1]=t,e[2]=n,e}function b(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e[2]=r[2]+t[2],e}function U(e,r,t){return e[0]=r[0]-t[0],e[1]=r[1]-t[1],e[2]=r[2]-t[2],e}function q(e,r,t){return e[0]=r[0]*t[0],e[1]=r[1]*t[1],e[2]=r[2]*t[2],e}function O(e,r,t){return e[0]=r[0]/t[0],e[1]=r[1]/t[1],e[2]=r[2]/t[2],e}function ye(e,r){return e[0]=Math.ceil(r[0]),e[1]=Math.ceil(r[1]),e[2]=Math.ceil(r[2]),e}function we(e,r){return e[0]=Math.floor(r[0]),e[1]=Math.floor(r[1]),e[2]=Math.floor(r[2]),e}function xe(e,r,t){return e[0]=Math.min(r[0],t[0]),e[1]=Math.min(r[1],t[1]),e[2]=Math.min(r[2],t[2]),e}function ze(e,r,t){return e[0]=Math.max(r[0],t[0]),e[1]=Math.max(r[1],t[1]),e[2]=Math.max(r[2],t[2]),e}function Te(e,r){return e[0]=Math.round(r[0]),e[1]=Math.round(r[1]),e[2]=Math.round(r[2]),e}function Ce(e,r,t){return e[0]=r[0]*t,e[1]=r[1]*t,e[2]=r[2]*t,e}function Ee(e,r,t,n){return e[0]=r[0]+t[0]*n,e[1]=r[1]+t[1]*n,e[2]=r[2]+t[2]*n,e}function R(e,r){var t=r[0]-e[0],n=r[1]-e[1],i=r[2]-e[2];return Math.hypot(t,n,i)}function I(e,r){var t=r[0]-e[0],n=r[1]-e[1],i=r[2]-e[2];return t*t+n*n+i*i}function j(e){var r=e[0],t=e[1],n=e[2];return r*r+t*t+n*n}function Ge(e,r){return e[0]=-r[0],e[1]=-r[1],e[2]=-r[2],e}function Ae(e,r){return e[0]=1/r[0],e[1]=1/r[1],e[2]=1/r[2],e}function Be(e,r){var t=r[0],n=r[1],i=r[2],a=t*t+n*n+i*i;return a>0&&(a=1/Math.sqrt(a)),e[0]=r[0]*a,e[1]=r[1]*a,e[2]=r[2]*a,e}function F(e,r){return e[0]*r[0]+e[1]*r[1]+e[2]*r[2]}function $(e,r,t){var n=r[0],i=r[1],a=r[2],s=t[0],c=t[1],h=t[2];return e[0]=i*h-a*c,e[1]=a*s-n*h,e[2]=n*c-i*s,e}function Se(e,r,t,n){var i=r[0],a=r[1],s=r[2];return e[0]=i+n*(t[0]-i),e[1]=a+n*(t[1]-a),e[2]=s+n*(t[2]-s),e}function Pe(e,r,t,n,i,a){var s=a*a,c=s*(2*a-3)+1,h=s*(a-2)+a,f=s*(a-1),o=s*(3-2*a);return e[0]=r[0]*c+t[0]*h+n[0]*f+i[0]*o,e[1]=r[1]*c+t[1]*h+n[1]*f+i[1]*o,e[2]=r[2]*c+t[2]*h+n[2]*f+i[2]*o,e}function $e(e,r,t,n,i,a){var s=1-a,c=s*s,h=a*a,f=c*s,o=3*a*c,l=3*h*s,d=h*a;return e[0]=r[0]*f+t[0]*o+n[0]*l+i[0]*d,e[1]=r[1]*f+t[1]*o+n[1]*l+i[1]*d,e[2]=r[2]*f+t[2]*o+n[2]*l+i[2]*d,e}function Le(e,r){r=r||1;var t=C()*2*Math.PI,n=C()*2-1,i=Math.sqrt(1-n*n)*r;return e[0]=Math.cos(t)*i,e[1]=Math.sin(t)*i,e[2]=n*r,e}function De(e,r,t){var n=r[0],i=r[1],a=r[2],s=t[3]*n+t[7]*i+t[11]*a+t[15];return s=s||1,e[0]=(t[0]*n+t[4]*i+t[8]*a+t[12])/s,e[1]=(t[1]*n+t[5]*i+t[9]*a+t[13])/s,e[2]=(t[2]*n+t[6]*i+t[10]*a+t[14])/s,e}function be(e,r,t){var n=r[0],i=r[1],a=r[2];return e[0]=n*t[0]+i*t[3]+a*t[6],e[1]=n*t[1]+i*t[4]+a*t[7],e[2]=n*t[2]+i*t[5]+a*t[8],e}function Ue(e,r,t){var n=t[0],i=t[1],a=t[2],s=t[3],c=r[0],h=r[1],f=r[2],o=i*f-a*h,l=a*c-n*f,d=n*h-i*c,u=i*d-a*l,g=a*o-n*d,M=n*l-i*o,p=s*2;return o*=p,l*=p,d*=p,u*=2,g*=2,M*=2,e[0]=c+o+u,e[1]=h+l+g,e[2]=f+d+M,e}function qe(e,r,t,n){var i=[],a=[];return i[0]=r[0]-t[0],i[1]=r[1]-t[1],i[2]=r[2]-t[2],a[0]=i[0],a[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),a[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),e[0]=a[0]+t[0],e[1]=a[1]+t[1],e[2]=a[2]+t[2],e}function Oe(e,r,t,n){var i=[],a=[];return i[0]=r[0]-t[0],i[1]=r[1]-t[1],i[2]=r[2]-t[2],a[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),a[1]=i[1],a[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),e[0]=a[0]+t[0],e[1]=a[1]+t[1],e[2]=a[2]+t[2],e}function Re(e,r,t,n){var i=[],a=[];return i[0]=r[0]-t[0],i[1]=r[1]-t[1],i[2]=r[2]-t[2],a[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),a[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),a[2]=i[2],e[0]=a[0]+t[0],e[1]=a[1]+t[1],e[2]=a[2]+t[2],e}function Ie(e,r){var t=e[0],n=e[1],i=e[2],a=r[0],s=r[1],c=r[2],h=Math.sqrt(t*t+n*n+i*i),f=Math.sqrt(a*a+s*s+c*c),o=h*f,l=o&&F(e,r)/o;return Math.acos(Math.min(Math.max(l,-1),1))}function je(e){return e[0]=0,e[1]=0,e[2]=0,e}function Fe(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function Ve(e,r){return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]}function Ne(e,r){var t=e[0],n=e[1],i=e[2],a=r[0],s=r[1],c=r[2];return Math.abs(t-a)<=m*Math.max(1,Math.abs(t),Math.abs(a))&&Math.abs(n-s)<=m*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-c)<=m*Math.max(1,Math.abs(i),Math.abs(c))}var _e=U,Qe=q,Ye=O,Xe=R,ke=I,He=D,We=j,Ze=function(){var e=z();return function(r,t,n,i,a,s){var c,h;for(t||(t=3),n||(n=0),i?h=Math.min(i*t+n,r.length):h=r.length,c=n;c<h;c+=t)e[0]=r[c],e[1]=r[c+1],e[2]=r[c+2],a(e,e,s),r[c]=e[0],r[c+1]=e[1],r[c+2]=e[2];return r}}();const Je=Object.freeze(Object.defineProperty({__proto__:null,add:b,angle:Ie,bezier:$e,ceil:ye,clone:me,copy:ge,create:z,cross:$,dist:Xe,distance:R,div:Ye,divide:O,dot:F,equals:Ne,exactEquals:Ve,floor:we,forEach:Ze,fromValues:pe,hermite:Pe,inverse:Ae,len:He,length:D,lerp:Se,max:ze,min:xe,mul:Qe,multiply:q,negate:Ge,normalize:Be,random:Le,rotateX:qe,rotateY:Oe,rotateZ:Re,round:Te,scale:Ce,scaleAndAdd:Ee,set:Me,sqrDist:ke,sqrLen:We,squaredDistance:I,squaredLength:j,str:Fe,sub:_e,subtract:U,transformMat3:be,transformMat4:De,transformQuat:Ue,zero:je},Symbol.toStringTag,{value:"Module"}));function V(){var e=new y(4);return y!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Ke(e){var r=new y(4);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r}function er(e,r,t,n){var i=new y(4);return i[0]=e,i[1]=r,i[2]=t,i[3]=n,i}function rr(e,r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e}function tr(e,r,t,n,i){return e[0]=r,e[1]=t,e[2]=n,e[3]=i,e}function nr(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e[2]=r[2]+t[2],e[3]=r[3]+t[3],e}function N(e,r,t){return e[0]=r[0]-t[0],e[1]=r[1]-t[1],e[2]=r[2]-t[2],e[3]=r[3]-t[3],e}function _(e,r,t){return e[0]=r[0]*t[0],e[1]=r[1]*t[1],e[2]=r[2]*t[2],e[3]=r[3]*t[3],e}function Q(e,r,t){return e[0]=r[0]/t[0],e[1]=r[1]/t[1],e[2]=r[2]/t[2],e[3]=r[3]/t[3],e}function ir(e,r){return e[0]=Math.ceil(r[0]),e[1]=Math.ceil(r[1]),e[2]=Math.ceil(r[2]),e[3]=Math.ceil(r[3]),e}function ar(e,r){return e[0]=Math.floor(r[0]),e[1]=Math.floor(r[1]),e[2]=Math.floor(r[2]),e[3]=Math.floor(r[3]),e}function sr(e,r,t){return e[0]=Math.min(r[0],t[0]),e[1]=Math.min(r[1],t[1]),e[2]=Math.min(r[2],t[2]),e[3]=Math.min(r[3],t[3]),e}function cr(e,r,t){return e[0]=Math.max(r[0],t[0]),e[1]=Math.max(r[1],t[1]),e[2]=Math.max(r[2],t[2]),e[3]=Math.max(r[3],t[3]),e}function hr(e,r){return e[0]=Math.round(r[0]),e[1]=Math.round(r[1]),e[2]=Math.round(r[2]),e[3]=Math.round(r[3]),e}function or(e,r,t){return e[0]=r[0]*t,e[1]=r[1]*t,e[2]=r[2]*t,e[3]=r[3]*t,e}function fr(e,r,t,n){return e[0]=r[0]+t[0]*n,e[1]=r[1]+t[1]*n,e[2]=r[2]+t[2]*n,e[3]=r[3]+t[3]*n,e}function Y(e,r){var t=r[0]-e[0],n=r[1]-e[1],i=r[2]-e[2],a=r[3]-e[3];return Math.hypot(t,n,i,a)}function X(e,r){var t=r[0]-e[0],n=r[1]-e[1],i=r[2]-e[2],a=r[3]-e[3];return t*t+n*n+i*i+a*a}function k(e){var r=e[0],t=e[1],n=e[2],i=e[3];return Math.hypot(r,t,n,i)}function H(e){var r=e[0],t=e[1],n=e[2],i=e[3];return r*r+t*t+n*n+i*i}function lr(e,r){return e[0]=-r[0],e[1]=-r[1],e[2]=-r[2],e[3]=-r[3],e}function dr(e,r){return e[0]=1/r[0],e[1]=1/r[1],e[2]=1/r[2],e[3]=1/r[3],e}function ur(e,r){var t=r[0],n=r[1],i=r[2],a=r[3],s=t*t+n*n+i*i+a*a;return s>0&&(s=1/Math.sqrt(s)),e[0]=t*s,e[1]=n*s,e[2]=i*s,e[3]=a*s,e}function vr(e,r){return e[0]*r[0]+e[1]*r[1]+e[2]*r[2]+e[3]*r[3]}function mr(e,r,t,n){var i=t[0]*n[1]-t[1]*n[0],a=t[0]*n[2]-t[2]*n[0],s=t[0]*n[3]-t[3]*n[0],c=t[1]*n[2]-t[2]*n[1],h=t[1]*n[3]-t[3]*n[1],f=t[2]*n[3]-t[3]*n[2],o=r[0],l=r[1],d=r[2],u=r[3];return e[0]=l*f-d*h+u*c,e[1]=-(o*f)+d*s-u*a,e[2]=o*h-l*s+u*i,e[3]=-(o*c)+l*a-d*i,e}function pr(e,r,t,n){var i=r[0],a=r[1],s=r[2],c=r[3];return e[0]=i+n*(t[0]-i),e[1]=a+n*(t[1]-a),e[2]=s+n*(t[2]-s),e[3]=c+n*(t[3]-c),e}function gr(e,r){r=r||1;var t,n,i,a,s,c;do t=C()*2-1,n=C()*2-1,s=t*t+n*n;while(s>=1);do i=C()*2-1,a=C()*2-1,c=i*i+a*a;while(c>=1);var h=Math.sqrt((1-s)/c);return e[0]=r*t,e[1]=r*n,e[2]=r*i*h,e[3]=r*a*h,e}function Mr(e,r,t){var n=r[0],i=r[1],a=r[2],s=r[3];return e[0]=t[0]*n+t[4]*i+t[8]*a+t[12]*s,e[1]=t[1]*n+t[5]*i+t[9]*a+t[13]*s,e[2]=t[2]*n+t[6]*i+t[10]*a+t[14]*s,e[3]=t[3]*n+t[7]*i+t[11]*a+t[15]*s,e}function yr(e,r,t){var n=r[0],i=r[1],a=r[2],s=t[0],c=t[1],h=t[2],f=t[3],o=f*n+c*a-h*i,l=f*i+h*n-s*a,d=f*a+s*i-c*n,u=-s*n-c*i-h*a;return e[0]=o*f+u*-s+l*-h-d*-c,e[1]=l*f+u*-c+d*-s-o*-h,e[2]=d*f+u*-h+o*-c-l*-s,e[3]=r[3],e}function wr(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function xr(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function zr(e,r){return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]&&e[3]===r[3]}function Tr(e,r){var t=e[0],n=e[1],i=e[2],a=e[3],s=r[0],c=r[1],h=r[2],f=r[3];return Math.abs(t-s)<=m*Math.max(1,Math.abs(t),Math.abs(s))&&Math.abs(n-c)<=m*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(i-h)<=m*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(a-f)<=m*Math.max(1,Math.abs(a),Math.abs(f))}var Cr=N,Er=_,Gr=Q,Ar=Y,Br=X,Sr=k,Pr=H,$r=function(){var e=V();return function(r,t,n,i,a,s){var c,h;for(t||(t=4),n||(n=0),i?h=Math.min(i*t+n,r.length):h=r.length,c=n;c<h;c+=t)e[0]=r[c],e[1]=r[c+1],e[2]=r[c+2],e[3]=r[c+3],a(e,e,s),r[c]=e[0],r[c+1]=e[1],r[c+2]=e[2],r[c+3]=e[3];return r}}();const Lr=Object.freeze(Object.defineProperty({__proto__:null,add:nr,ceil:ir,clone:Ke,copy:rr,create:V,cross:mr,dist:Ar,distance:Y,div:Gr,divide:Q,dot:vr,equals:Tr,exactEquals:zr,floor:ar,forEach:$r,fromValues:er,inverse:dr,len:Sr,length:k,lerp:pr,max:cr,min:sr,mul:Er,multiply:_,negate:lr,normalize:ur,random:gr,round:hr,scale:or,scaleAndAdd:fr,set:tr,sqrDist:Br,sqrLen:Pr,squaredDistance:X,squaredLength:H,str:xr,sub:Cr,subtract:N,transformMat4:Mr,transformQuat:yr,zero:wr},Symbol.toStringTag,{value:"Module"}));class B{constructor(r,t){this.update=()=>{},this.name=r,this.parent=t}}const T=e=>e*Math.PI/180,W=e=>{const r=Math.pow(10,e-1),t=Math.pow(10,e)-1;return Math.floor(Math.random()*(t-r+1))+r};class Z extends B{constructor(r){super("CameraComponent",r),this.update=()=>{this.forwards=[Math.cos(T(this.parent.transformComponent.eulers[2]))*Math.cos(T(this.parent.transformComponent.eulers[1])),Math.sin(T(this.parent.transformComponent.eulers[2]))*Math.cos(T(this.parent.transformComponent.eulers[1])),Math.sin(T(this.parent.transformComponent.eulers[1]))],$(this.right,this.forwards,[0,0,1]),$(this.up,this.right,this.forwards);let t=z();b(t,new Float32Array(this.parent.transformComponent.position),this.forwards),ve(this.view,new Float32Array(this.parent.transformComponent.position),t,this.up)},this.getView=()=>this.view,this.view=S(),this.forwards=z(),this.right=z(),this.up=z()}}class J extends B{constructor(r){super("TriangleComponent",r),this.update=()=>{this.parent.transformComponent.eulers[2]+=1,this.parent.transformComponent.eulers[2]%=360,this.model=S(),L(this.model,this.model,this.parent.transformComponent.position),le(this.model,this.model,T(this.parent.transformComponent.eulers[2]))},this.getModel=()=>this.model}}class K extends B{constructor(r){super("QuadComponent",r),this.update=()=>{this.model=S(),L(this.model,this.model,this.parent.transformComponent.position)},this.getModel=()=>this.model}}class Dr{constructor(r){this.update=()=>{let n=0;this.gameObjects.forEach(i=>{i.components.forEach(a=>{if(a.update(),a instanceof J){const s=a.getModel();for(let c=0;c<16;c++)this.objectData[16*n+c]=s.at(c);n++}else if(a instanceof K){const s=a.getModel();for(let c=0;c<16;c++)this.objectData[16*n+c]=s.at(c);n++}})}),this.camera.update()},this.getCamera=()=>this.camera,this.getObjectData=()=>({viewTransform:this.camera.getView(),modelTransforms:this.objectData}),this.addGameObject=n=>{this.gameObjects.push(n)},this.getGameObjects=()=>this.gameObjects;const t=r.getComponent(Z);if(!t)throw new Error("Camera component not found within gameobject specified.");this.camera=t,this.gameObjects=[],this.objectData=new Float32Array(16*1024),this.gameObjects.push(r)}}const ee=`struct TransformData {
    view: mat4x4<f32>,
    projection: mat4x4<f32>
};

struct ObjectData {
    model: array<mat4x4<f32>>,
};

@binding(0) @group(0) var<uniform> transformUBO: TransformData;
@binding(1) @group(0) var<storage, read> objects: ObjectData;

@binding(0) @group(1) var myTexture: texture_2d<f32>;
@binding(1) @group(1) var mySampler: sampler;

struct Fragment {
    @builtin(position) Position : vec4<f32>,
    @location(0) TexCoord: vec2<f32>
};

@vertex
fn vs_main(
    @builtin(instance_index) id: u32, 
    @location(0) vertexPosition: vec3<f32>, 
    @location(1) vertexTexCoord: vec2<f32>) -> Fragment {

    var output : Fragment;
    output.Position = transformUBO.projection * transformUBO.view * objects.model[id] * vec4<f32>(vertexPosition, 1.0);
    output.TexCoord = vertexTexCoord;
    return output;
};

@fragment
fn fs_main(@location(0) TexCoord : vec2<f32>) -> @location(0) vec4<f32> {
    return textureSample(myTexture, mySampler, TexCoord);
};`,x=class x{constructor(){}static async initialize(r){if(x.instance){console.warn("Renderer is already initialized.");return}x.adapter=r,x.instance=await this.adapter.requestDevice()}static getInstance(){if(!x.instance)throw new Error("Device is not initialized. Call initialize() first.");return x.instance}};x.instance=null;let E=x;class re{constructor(r){this.addTexture=t=>{this.materials.push(t)},this.initialize=async()=>{await this.setupDevice(),await this.createBindGroupLayouts(),await this.createAssets(),await this.createDepthBufferResources(),await this.createPipeline(),await this.createBindGroup()},this.setupDevice=async()=>{this.adapter=await navigator.gpu.requestAdapter(),await E.initialize(this.adapter),this.device=E.getInstance(),this.context=this.canvas.getContext("webgpu"),this.format="bgra8unorm",this.context.configure({device:this.device,format:this.format,alphaMode:"opaque"})},this.createBindGroupLayouts=async()=>{this.frameGroupLayout=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{}},{binding:1,visibility:GPUShaderStage.VERTEX,buffer:{type:"read-only-storage"}}]}),this.materialGroupLayout=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,texture:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{}}]})},this.createAssets=async()=>{for(let n of this.materials)await n.initialize(this.device,n.url,this.materialGroupLayout),console.log(`Initialized material: ${n.url}`);this.uniformBuffer=this.device.createBuffer({size:64*2,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});const t={size:64*2048,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST};this.objectBuffer=this.device.createBuffer(t)},this.createDepthBufferResources=async()=>{this.depthStencilState={format:"depth24plus-stencil8",depthWriteEnabled:!0,depthCompare:"less-equal"};const n={size:{width:this.canvas.width,height:this.canvas.height,depthOrArrayLayers:1},format:"depth24plus-stencil8",usage:GPUTextureUsage.RENDER_ATTACHMENT};this.depthStencilBuffer=this.device.createTexture(n);const i={format:"depth24plus-stencil8",dimension:"2d",aspect:"all"};this.depthStencilView=this.depthStencilBuffer.createView(i),this.depthStencilAttachment={view:this.depthStencilView,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store",stencilLoadOp:"clear",stencilStoreOp:"discard"}},this.createPipeline=async()=>{const t=this.device.createPipelineLayout({bindGroupLayouts:[this.frameGroupLayout,this.materialGroupLayout]});this.pipeline=this.device.createRenderPipeline({vertex:{module:this.device.createShaderModule({code:ee}),entryPoint:"vs_main",buffers:[{arrayStride:20,attributes:[{shaderLocation:0,format:"float32x3",offset:0},{shaderLocation:1,format:"float32x2",offset:12}]}]},fragment:{module:this.device.createShaderModule({code:ee}),entryPoint:"fs_main",targets:[{format:this.format}]},primitive:{topology:"triangle-list"},layout:t,depthStencil:this.depthStencilState})},this.createBindGroup=async()=>{this.frameBindGroup=this.device.createBindGroup({layout:this.frameGroupLayout,entries:[{binding:0,resource:{buffer:this.uniformBuffer}},{binding:1,resource:{buffer:this.objectBuffer}}]})},this.startRender=async t=>{this.activeScene=t;const n=t.getObjectData();if(!this.device)throw new Error("GPUDevice is not initialized.");const i=S();ue(i,Math.PI/4,800/600,.1,500);const a=n.viewTransform;this.device.queue.writeBuffer(this.objectBuffer,0,n.modelTransforms,0,n.modelTransforms.length),this.device.queue.writeBuffer(this.uniformBuffer,0,a),this.device.queue.writeBuffer(this.uniformBuffer,64,i);const s=this.device.createCommandEncoder(),c=this.context.getCurrentTexture().createView(),h=s.beginRenderPass({colorAttachments:[{view:c,clearValue:{r:.5,g:0,b:.25,a:1},loadOp:"clear",storeOp:"store"}],depthStencilAttachment:this.depthStencilAttachment});h.setPipeline(this.pipeline),h.setBindGroup(0,this.frameBindGroup);const f=t.getGameObjects();let o=0;f.forEach(l=>{l.createMeshes(),h.setVertexBuffer(0,l.mesh.buffer),h.setBindGroup(1,l.material.bindGroup),h.draw(l.verticieCount,1,0,o*l.verticieCount),o++}),h.end(),this.device.queue.submit([s.finish()])},this.canvas=r,this.materials=[]}}const w=class w{constructor(){}static async initialize(r){if(w.instance){console.warn("Renderer is already initialized.");return}w.canvas=r,w.instance=new re(r)}static getInstance(){if(!w.instance)throw new Error("Renderer is not initialized. Call initialize() first.");return w.instance}};w.instance=null,w.canvas=null;let G=w;class br{constructor(r){if(this.createRenderer=async()=>{this.rendererInitialized=G.initialize(this.canvas),await this.rendererInitialized,this.renderer=G.getInstance()},this.getRenderer=async()=>(await this.rendererInitialized,this.renderer),this.validateActiveScene=()=>!0,this.startRenderProcess=async()=>{await this.rendererInitialized,await this.renderer.initialize(),requestAnimationFrame(this.gameLoop)},this.gameLoop=async()=>{if(!this.activeScene)throw new Error("No current active scene was set.");this.activeScene.update(),await this.rendererInitialized,this.renderer.startRender(this.activeScene),requestAnimationFrame(this.gameLoop)},!r)throw new Error("Improper canvas specificed in initializing engine.");if(this.canvas=r,navigator.gpu)console.log("WebGPU supported, started to run engine.");else throw new Error("WebGPU is not supported on this browser.");this.createRenderer()}get activeScene(){return this._activeScene}set activeScene(r){this._activeScene=r}}class te extends B{constructor(r){super("TransformComponent",r),this.position=[0,0,0],this.eulers=z(),this.eulers[2]=0}}class ne{constructor(r){const t=new Float32Array([0,0,.5,.5,0,0,-.5,-.5,0,1,0,.5,-.5,1,1]),n=GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,i={size:t.byteLength,usage:n,mappedAtCreation:!0};this.buffer=r.createBuffer(i),new Float32Array(this.buffer.getMappedRange()).set(t),this.buffer.unmap(),this.bufferLayout={arrayStride:20,attributes:[{shaderLocation:0,format:"float32x3",offset:0},{shaderLocation:1,format:"float32x2",offset:12}]}}}class ie{constructor(r){const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,.5,.5,0,1,1,-.5,.5,0,0,1,-.5,-.5,0,0,0]),n=GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,i={size:t.byteLength,usage:n,mappedAtCreation:!0};this.buffer=r.createBuffer(i),new Float32Array(this.buffer.getMappedRange()).set(t),this.buffer.unmap(),this.bufferLayout={arrayStride:20,attributes:[{shaderLocation:0,format:"float32x3",offset:0},{shaderLocation:1,format:"float32x2",offset:12}]}}}var P=(e=>(e[e.TRIANGLE=0]="TRIANGLE",e[e.QUAD=1]="QUAD",e))(P||{});class Ur{constructor(r,t,n){this.verticieCount=3,this.setMaterial=i=>{const s=G.getInstance().materials.filter(c=>c.url==i);if(s.length>1)throw new Error("Multiple instances of same material url found. Please remove duplicates.");console.log(s[0],this),this.material=s[0]},this.createMeshes=()=>{switch(this.meshType){case P.QUAD:this.mesh=new ie(E.getInstance()),this.verticieCount=6;break;case P.TRIANGLE:this.mesh=new ne(E.getInstance()),this.verticieCount=3;break;default:throw new Error("Mesh type specified is invalid.")}},this.name=r,this.instanceId=W(10),this.components=[],this.transformComponent=new te(this),this.meshType=t,this.setMaterial(n.url)}getComponent(r){for(const t of this.components)if(t instanceof r)return t;return null}addComponent(r){for(const t of this.components)if(t.name==r.name)return console.error("Trying to add duplicate component with same name."),null;return this.components.push(r),r}}class qr{constructor(r){if(this.initialize=async(n,i,a)=>{const c=await(await fetch(i)).blob(),h=await createImageBitmap(c);this.loadImageBitmap(n,h);const f={format:"rgba8unorm",dimension:"2d",aspect:"all",baseMipLevel:0,mipLevelCount:1,baseArrayLayer:0,arrayLayerCount:1};this.view=this.texture.createView(f);const o={addressModeU:"repeat",addressModeV:"repeat",magFilter:"linear",minFilter:"nearest",mipmapFilter:"nearest",maxAnisotropy:1};this.sampler=n.createSampler(o);const l=n.createBindGroup({layout:a,entries:[{binding:0,resource:this.view},{binding:1,resource:this.sampler}]});this.bindGroup=l},this.loadImageBitmap=async(n,i)=>{const a={size:{width:i.width,height:i.height},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT};this.texture=n.createTexture(a),n.queue.copyExternalImageToTexture({source:i},{texture:this.texture},a.size)},this.url=r,G.getInstance().materials.filter(n=>n.url==r).length!==0)throw new Error("Material with image already found, please use existing material.")}}v.BaseComponent=B,v.CameraComponent=Z,v.Deg2Rad=T,v.EpicEngine=br,v.GameObject=Ur,v.Material=qr,v.ObjectTypes=P,v.QuadComponent=K,v.QuadMesh=ie,v.Renderer=re,v.Scene=Dr,v.TransformComponent=te,v.TriangleComponent=J,v.TriangleMesh=ne,v.generateId=W,v.vec3=Je,v.vec4=Lr,Object.defineProperty(v,Symbol.toStringTag,{value:"Module"})});
