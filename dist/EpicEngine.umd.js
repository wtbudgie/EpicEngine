(function(v,m){typeof exports=="object"&&typeof module<"u"?m(exports):typeof define=="function"&&define.amd?define(["exports"],m):(v=typeof globalThis<"u"?globalThis:v||self,m(v.EpicEngine={}))})(this,function(v){"use strict";var m=1e-6,g=typeof Float32Array<"u"?Float32Array:Array,z=Math.random;Math.hypot||(Math.hypot=function(){for(var e=0,r=arguments.length;r--;)e+=arguments[r]*arguments[r];return Math.sqrt(e)});function G(){var e=new g(16);return g!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function xe(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function O(e,r,t){var n=t[0],i=t[1],a=t[2],s,c,h,f,o,l,u,d,p,M,y,E;return r===e?(e[12]=r[0]*n+r[4]*i+r[8]*a+r[12],e[13]=r[1]*n+r[5]*i+r[9]*a+r[13],e[14]=r[2]*n+r[6]*i+r[10]*a+r[14],e[15]=r[3]*n+r[7]*i+r[11]*a+r[15]):(s=r[0],c=r[1],h=r[2],f=r[3],o=r[4],l=r[5],u=r[6],d=r[7],p=r[8],M=r[9],y=r[10],E=r[11],e[0]=s,e[1]=c,e[2]=h,e[3]=f,e[4]=o,e[5]=l,e[6]=u,e[7]=d,e[8]=p,e[9]=M,e[10]=y,e[11]=E,e[12]=s*n+o*i+p*a+r[12],e[13]=c*n+l*i+M*a+r[13],e[14]=h*n+u*i+y*a+r[14],e[15]=f*n+d*i+E*a+r[15]),e}function we(e,r,t){var n=Math.sin(t),i=Math.cos(t),a=r[0],s=r[1],c=r[2],h=r[3],f=r[4],o=r[5],l=r[6],u=r[7];return r!==e&&(e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[0]=a*i+f*n,e[1]=s*i+o*n,e[2]=c*i+l*n,e[3]=h*i+u*n,e[4]=f*i-a*n,e[5]=o*i-s*n,e[6]=l*i-c*n,e[7]=u*i-h*n,e}function ze(e,r,t,n,i){var a=1/Math.tan(r/2),s;return e[0]=a/t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==1/0?(s=1/(n-i),e[10]=(i+n)*s,e[14]=2*i*n*s):(e[10]=-1,e[14]=-2*n),e}var $e=ze;function Ce(e,r,t,n){var i,a,s,c,h,f,o,l,u,d,p=r[0],M=r[1],y=r[2],E=n[0],pe=n[1],me=n[2],Me=t[0],ge=t[1],ye=t[2];return Math.abs(p-Me)<m&&Math.abs(M-ge)<m&&Math.abs(y-ye)<m?xe(e):(o=p-Me,l=M-ge,u=y-ye,d=1/Math.hypot(o,l,u),o*=d,l*=d,u*=d,i=pe*u-me*l,a=me*o-E*u,s=E*l-pe*o,d=Math.hypot(i,a,s),d?(d=1/d,i*=d,a*=d,s*=d):(i=0,a=0,s=0),c=l*s-u*a,h=u*i-o*s,f=o*a-l*i,d=Math.hypot(c,h,f),d?(d=1/d,c*=d,h*=d,f*=d):(c=0,h=0,f=0),e[0]=i,e[1]=c,e[2]=o,e[3]=0,e[4]=a,e[5]=h,e[6]=l,e[7]=0,e[8]=s,e[9]=f,e[10]=u,e[11]=0,e[12]=-(i*p+a*M+s*y),e[13]=-(c*p+h*M+f*y),e[14]=-(o*p+l*M+u*y),e[15]=1,e)}function $(){var e=new g(3);return g!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Te(e){var r=new g(3);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r}function D(e){var r=e[0],t=e[1],n=e[2];return Math.hypot(r,t,n)}function Ee(e,r,t){var n=new g(3);return n[0]=e,n[1]=r,n[2]=t,n}function Ae(e,r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],e}function be(e,r,t,n){return e[0]=r,e[1]=t,e[2]=n,e}function P(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e[2]=r[2]+t[2],e}function j(e,r,t){return e[0]=r[0]-t[0],e[1]=r[1]-t[1],e[2]=r[2]-t[2],e}function U(e,r,t){return e[0]=r[0]*t[0],e[1]=r[1]*t[1],e[2]=r[2]*t[2],e}function F(e,r,t){return e[0]=r[0]/t[0],e[1]=r[1]/t[1],e[2]=r[2]/t[2],e}function Be(e,r){return e[0]=Math.ceil(r[0]),e[1]=Math.ceil(r[1]),e[2]=Math.ceil(r[2]),e}function qe(e,r){return e[0]=Math.floor(r[0]),e[1]=Math.floor(r[1]),e[2]=Math.floor(r[2]),e}function Ge(e,r,t){return e[0]=Math.min(r[0],t[0]),e[1]=Math.min(r[1],t[1]),e[2]=Math.min(r[2],t[2]),e}function Le(e,r,t){return e[0]=Math.max(r[0],t[0]),e[1]=Math.max(r[1],t[1]),e[2]=Math.max(r[2],t[2]),e}function Se(e,r){return e[0]=Math.round(r[0]),e[1]=Math.round(r[1]),e[2]=Math.round(r[2]),e}function Oe(e,r,t){return e[0]=r[0]*t,e[1]=r[1]*t,e[2]=r[2]*t,e}function De(e,r,t,n){return e[0]=r[0]+t[0]*n,e[1]=r[1]+t[1]*n,e[2]=r[2]+t[2]*n,e}function I(e,r){var t=r[0]-e[0],n=r[1]-e[1],i=r[2]-e[2];return Math.hypot(t,n,i)}function R(e,r){var t=r[0]-e[0],n=r[1]-e[1],i=r[2]-e[2];return t*t+n*n+i*i}function V(e){var r=e[0],t=e[1],n=e[2];return r*r+t*t+n*n}function Pe(e,r){return e[0]=-r[0],e[1]=-r[1],e[2]=-r[2],e}function je(e,r){return e[0]=1/r[0],e[1]=1/r[1],e[2]=1/r[2],e}function Ue(e,r){var t=r[0],n=r[1],i=r[2],a=t*t+n*n+i*i;return a>0&&(a=1/Math.sqrt(a)),e[0]=r[0]*a,e[1]=r[1]*a,e[2]=r[2]*a,e}function N(e,r){return e[0]*r[0]+e[1]*r[1]+e[2]*r[2]}function L(e,r,t){var n=r[0],i=r[1],a=r[2],s=t[0],c=t[1],h=t[2];return e[0]=i*h-a*c,e[1]=a*s-n*h,e[2]=n*c-i*s,e}function Fe(e,r,t,n){var i=r[0],a=r[1],s=r[2];return e[0]=i+n*(t[0]-i),e[1]=a+n*(t[1]-a),e[2]=s+n*(t[2]-s),e}function Ie(e,r,t,n,i,a){var s=a*a,c=s*(2*a-3)+1,h=s*(a-2)+a,f=s*(a-1),o=s*(3-2*a);return e[0]=r[0]*c+t[0]*h+n[0]*f+i[0]*o,e[1]=r[1]*c+t[1]*h+n[1]*f+i[1]*o,e[2]=r[2]*c+t[2]*h+n[2]*f+i[2]*o,e}function Re(e,r,t,n,i,a){var s=1-a,c=s*s,h=a*a,f=c*s,o=3*a*c,l=3*h*s,u=h*a;return e[0]=r[0]*f+t[0]*o+n[0]*l+i[0]*u,e[1]=r[1]*f+t[1]*o+n[1]*l+i[1]*u,e[2]=r[2]*f+t[2]*o+n[2]*l+i[2]*u,e}function Ve(e,r){r=r||1;var t=z()*2*Math.PI,n=z()*2-1,i=Math.sqrt(1-n*n)*r;return e[0]=Math.cos(t)*i,e[1]=Math.sin(t)*i,e[2]=n*r,e}function Ne(e,r,t){var n=r[0],i=r[1],a=r[2],s=t[3]*n+t[7]*i+t[11]*a+t[15];return s=s||1,e[0]=(t[0]*n+t[4]*i+t[8]*a+t[12])/s,e[1]=(t[1]*n+t[5]*i+t[9]*a+t[13])/s,e[2]=(t[2]*n+t[6]*i+t[10]*a+t[14])/s,e}function _e(e,r,t){var n=r[0],i=r[1],a=r[2];return e[0]=n*t[0]+i*t[3]+a*t[6],e[1]=n*t[1]+i*t[4]+a*t[7],e[2]=n*t[2]+i*t[5]+a*t[8],e}function ke(e,r,t){var n=t[0],i=t[1],a=t[2],s=t[3],c=r[0],h=r[1],f=r[2],o=i*f-a*h,l=a*c-n*f,u=n*h-i*c,d=i*u-a*l,p=a*o-n*u,M=n*l-i*o,y=s*2;return o*=y,l*=y,u*=y,d*=2,p*=2,M*=2,e[0]=c+o+d,e[1]=h+l+p,e[2]=f+u+M,e}function Qe(e,r,t,n){var i=[],a=[];return i[0]=r[0]-t[0],i[1]=r[1]-t[1],i[2]=r[2]-t[2],a[0]=i[0],a[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),a[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),e[0]=a[0]+t[0],e[1]=a[1]+t[1],e[2]=a[2]+t[2],e}function Ye(e,r,t,n){var i=[],a=[];return i[0]=r[0]-t[0],i[1]=r[1]-t[1],i[2]=r[2]-t[2],a[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),a[1]=i[1],a[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),e[0]=a[0]+t[0],e[1]=a[1]+t[1],e[2]=a[2]+t[2],e}function Xe(e,r,t,n){var i=[],a=[];return i[0]=r[0]-t[0],i[1]=r[1]-t[1],i[2]=r[2]-t[2],a[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),a[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),a[2]=i[2],e[0]=a[0]+t[0],e[1]=a[1]+t[1],e[2]=a[2]+t[2],e}function Je(e,r){var t=e[0],n=e[1],i=e[2],a=r[0],s=r[1],c=r[2],h=Math.sqrt(t*t+n*n+i*i),f=Math.sqrt(a*a+s*s+c*c),o=h*f,l=o&&N(e,r)/o;return Math.acos(Math.min(Math.max(l,-1),1))}function He(e){return e[0]=0,e[1]=0,e[2]=0,e}function We(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function Ze(e,r){return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]}function Ke(e,r){var t=e[0],n=e[1],i=e[2],a=r[0],s=r[1],c=r[2];return Math.abs(t-a)<=m*Math.max(1,Math.abs(t),Math.abs(a))&&Math.abs(n-s)<=m*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-c)<=m*Math.max(1,Math.abs(i),Math.abs(c))}var er=j,rr=U,tr=F,nr=I,ir=R,ar=D,sr=V,cr=function(){var e=$();return function(r,t,n,i,a,s){var c,h;for(t||(t=3),n||(n=0),i?h=Math.min(i*t+n,r.length):h=r.length,c=n;c<h;c+=t)e[0]=r[c],e[1]=r[c+1],e[2]=r[c+2],a(e,e,s),r[c]=e[0],r[c+1]=e[1],r[c+2]=e[2];return r}}();const hr=Object.freeze(Object.defineProperty({__proto__:null,add:P,angle:Je,bezier:Re,ceil:Be,clone:Te,copy:Ae,create:$,cross:L,dist:nr,distance:I,div:tr,divide:F,dot:N,equals:Ke,exactEquals:Ze,floor:qe,forEach:cr,fromValues:Ee,hermite:Ie,inverse:je,len:ar,length:D,lerp:Fe,max:Le,min:Ge,mul:rr,multiply:U,negate:Pe,normalize:Ue,random:Ve,rotateX:Qe,rotateY:Ye,rotateZ:Xe,round:Se,scale:Oe,scaleAndAdd:De,set:be,sqrDist:ir,sqrLen:sr,squaredDistance:R,squaredLength:V,str:We,sub:er,subtract:j,transformMat3:_e,transformMat4:Ne,transformQuat:ke,zero:He},Symbol.toStringTag,{value:"Module"}));function _(){var e=new g(4);return g!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function or(e){var r=new g(4);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r}function fr(e,r,t,n){var i=new g(4);return i[0]=e,i[1]=r,i[2]=t,i[3]=n,i}function lr(e,r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e}function dr(e,r,t,n,i){return e[0]=r,e[1]=t,e[2]=n,e[3]=i,e}function ur(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e[2]=r[2]+t[2],e[3]=r[3]+t[3],e}function k(e,r,t){return e[0]=r[0]-t[0],e[1]=r[1]-t[1],e[2]=r[2]-t[2],e[3]=r[3]-t[3],e}function Q(e,r,t){return e[0]=r[0]*t[0],e[1]=r[1]*t[1],e[2]=r[2]*t[2],e[3]=r[3]*t[3],e}function Y(e,r,t){return e[0]=r[0]/t[0],e[1]=r[1]/t[1],e[2]=r[2]/t[2],e[3]=r[3]/t[3],e}function vr(e,r){return e[0]=Math.ceil(r[0]),e[1]=Math.ceil(r[1]),e[2]=Math.ceil(r[2]),e[3]=Math.ceil(r[3]),e}function pr(e,r){return e[0]=Math.floor(r[0]),e[1]=Math.floor(r[1]),e[2]=Math.floor(r[2]),e[3]=Math.floor(r[3]),e}function mr(e,r,t){return e[0]=Math.min(r[0],t[0]),e[1]=Math.min(r[1],t[1]),e[2]=Math.min(r[2],t[2]),e[3]=Math.min(r[3],t[3]),e}function Mr(e,r,t){return e[0]=Math.max(r[0],t[0]),e[1]=Math.max(r[1],t[1]),e[2]=Math.max(r[2],t[2]),e[3]=Math.max(r[3],t[3]),e}function gr(e,r){return e[0]=Math.round(r[0]),e[1]=Math.round(r[1]),e[2]=Math.round(r[2]),e[3]=Math.round(r[3]),e}function yr(e,r,t){return e[0]=r[0]*t,e[1]=r[1]*t,e[2]=r[2]*t,e[3]=r[3]*t,e}function xr(e,r,t,n){return e[0]=r[0]+t[0]*n,e[1]=r[1]+t[1]*n,e[2]=r[2]+t[2]*n,e[3]=r[3]+t[3]*n,e}function X(e,r){var t=r[0]-e[0],n=r[1]-e[1],i=r[2]-e[2],a=r[3]-e[3];return Math.hypot(t,n,i,a)}function J(e,r){var t=r[0]-e[0],n=r[1]-e[1],i=r[2]-e[2],a=r[3]-e[3];return t*t+n*n+i*i+a*a}function H(e){var r=e[0],t=e[1],n=e[2],i=e[3];return Math.hypot(r,t,n,i)}function W(e){var r=e[0],t=e[1],n=e[2],i=e[3];return r*r+t*t+n*n+i*i}function wr(e,r){return e[0]=-r[0],e[1]=-r[1],e[2]=-r[2],e[3]=-r[3],e}function zr(e,r){return e[0]=1/r[0],e[1]=1/r[1],e[2]=1/r[2],e[3]=1/r[3],e}function $r(e,r){var t=r[0],n=r[1],i=r[2],a=r[3],s=t*t+n*n+i*i+a*a;return s>0&&(s=1/Math.sqrt(s)),e[0]=t*s,e[1]=n*s,e[2]=i*s,e[3]=a*s,e}function Cr(e,r){return e[0]*r[0]+e[1]*r[1]+e[2]*r[2]+e[3]*r[3]}function Tr(e,r,t,n){var i=t[0]*n[1]-t[1]*n[0],a=t[0]*n[2]-t[2]*n[0],s=t[0]*n[3]-t[3]*n[0],c=t[1]*n[2]-t[2]*n[1],h=t[1]*n[3]-t[3]*n[1],f=t[2]*n[3]-t[3]*n[2],o=r[0],l=r[1],u=r[2],d=r[3];return e[0]=l*f-u*h+d*c,e[1]=-(o*f)+u*s-d*a,e[2]=o*h-l*s+d*i,e[3]=-(o*c)+l*a-u*i,e}function Er(e,r,t,n){var i=r[0],a=r[1],s=r[2],c=r[3];return e[0]=i+n*(t[0]-i),e[1]=a+n*(t[1]-a),e[2]=s+n*(t[2]-s),e[3]=c+n*(t[3]-c),e}function Ar(e,r){r=r||1;var t,n,i,a,s,c;do t=z()*2-1,n=z()*2-1,s=t*t+n*n;while(s>=1);do i=z()*2-1,a=z()*2-1,c=i*i+a*a;while(c>=1);var h=Math.sqrt((1-s)/c);return e[0]=r*t,e[1]=r*n,e[2]=r*i*h,e[3]=r*a*h,e}function br(e,r,t){var n=r[0],i=r[1],a=r[2],s=r[3];return e[0]=t[0]*n+t[4]*i+t[8]*a+t[12]*s,e[1]=t[1]*n+t[5]*i+t[9]*a+t[13]*s,e[2]=t[2]*n+t[6]*i+t[10]*a+t[14]*s,e[3]=t[3]*n+t[7]*i+t[11]*a+t[15]*s,e}function Br(e,r,t){var n=r[0],i=r[1],a=r[2],s=t[0],c=t[1],h=t[2],f=t[3],o=f*n+c*a-h*i,l=f*i+h*n-s*a,u=f*a+s*i-c*n,d=-s*n-c*i-h*a;return e[0]=o*f+d*-s+l*-h-u*-c,e[1]=l*f+d*-c+u*-s-o*-h,e[2]=u*f+d*-h+o*-c-l*-s,e[3]=r[3],e}function qr(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function Gr(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Lr(e,r){return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]&&e[3]===r[3]}function Sr(e,r){var t=e[0],n=e[1],i=e[2],a=e[3],s=r[0],c=r[1],h=r[2],f=r[3];return Math.abs(t-s)<=m*Math.max(1,Math.abs(t),Math.abs(s))&&Math.abs(n-c)<=m*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(i-h)<=m*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(a-f)<=m*Math.max(1,Math.abs(a),Math.abs(f))}var Or=k,Dr=Q,Pr=Y,jr=X,Ur=J,Fr=H,Ir=W,Rr=function(){var e=_();return function(r,t,n,i,a,s){var c,h;for(t||(t=4),n||(n=0),i?h=Math.min(i*t+n,r.length):h=r.length,c=n;c<h;c+=t)e[0]=r[c],e[1]=r[c+1],e[2]=r[c+2],e[3]=r[c+3],a(e,e,s),r[c]=e[0],r[c+1]=e[1],r[c+2]=e[2],r[c+3]=e[3];return r}}();const Vr=Object.freeze(Object.defineProperty({__proto__:null,add:ur,ceil:vr,clone:or,copy:lr,create:_,cross:Tr,dist:jr,distance:X,div:Pr,divide:Y,dot:Cr,equals:Sr,exactEquals:Lr,floor:pr,forEach:Rr,fromValues:fr,inverse:zr,len:Fr,length:H,lerp:Er,max:Mr,min:mr,mul:Dr,multiply:Q,negate:wr,normalize:$r,random:Ar,round:gr,scale:yr,scaleAndAdd:xr,set:dr,sqrDist:Ur,sqrLen:Ir,squaredDistance:J,squaredLength:W,str:Gr,sub:Or,subtract:k,transformMat4:br,transformQuat:Br,zero:qr},Symbol.toStringTag,{value:"Module"}));function Z(){var e=new g(2);return g!=Float32Array&&(e[0]=0,e[1]=0),e}function Nr(e){var r=new g(2);return r[0]=e[0],r[1]=e[1],r}function _r(e,r){var t=new g(2);return t[0]=e,t[1]=r,t}function kr(e,r){return e[0]=r[0],e[1]=r[1],e}function Qr(e,r,t){return e[0]=r,e[1]=t,e}function Yr(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e}function K(e,r,t){return e[0]=r[0]-t[0],e[1]=r[1]-t[1],e}function ee(e,r,t){return e[0]=r[0]*t[0],e[1]=r[1]*t[1],e}function re(e,r,t){return e[0]=r[0]/t[0],e[1]=r[1]/t[1],e}function Xr(e,r){return e[0]=Math.ceil(r[0]),e[1]=Math.ceil(r[1]),e}function Jr(e,r){return e[0]=Math.floor(r[0]),e[1]=Math.floor(r[1]),e}function Hr(e,r,t){return e[0]=Math.min(r[0],t[0]),e[1]=Math.min(r[1],t[1]),e}function Wr(e,r,t){return e[0]=Math.max(r[0],t[0]),e[1]=Math.max(r[1],t[1]),e}function Zr(e,r){return e[0]=Math.round(r[0]),e[1]=Math.round(r[1]),e}function Kr(e,r,t){return e[0]=r[0]*t,e[1]=r[1]*t,e}function et(e,r,t,n){return e[0]=r[0]+t[0]*n,e[1]=r[1]+t[1]*n,e}function te(e,r){var t=r[0]-e[0],n=r[1]-e[1];return Math.hypot(t,n)}function ne(e,r){var t=r[0]-e[0],n=r[1]-e[1];return t*t+n*n}function ie(e){var r=e[0],t=e[1];return Math.hypot(r,t)}function ae(e){var r=e[0],t=e[1];return r*r+t*t}function rt(e,r){return e[0]=-r[0],e[1]=-r[1],e}function tt(e,r){return e[0]=1/r[0],e[1]=1/r[1],e}function nt(e,r){var t=r[0],n=r[1],i=t*t+n*n;return i>0&&(i=1/Math.sqrt(i)),e[0]=r[0]*i,e[1]=r[1]*i,e}function it(e,r){return e[0]*r[0]+e[1]*r[1]}function at(e,r,t){var n=r[0]*t[1]-r[1]*t[0];return e[0]=e[1]=0,e[2]=n,e}function st(e,r,t,n){var i=r[0],a=r[1];return e[0]=i+n*(t[0]-i),e[1]=a+n*(t[1]-a),e}function ct(e,r){r=r||1;var t=z()*2*Math.PI;return e[0]=Math.cos(t)*r,e[1]=Math.sin(t)*r,e}function ht(e,r,t){var n=r[0],i=r[1];return e[0]=t[0]*n+t[2]*i,e[1]=t[1]*n+t[3]*i,e}function ot(e,r,t){var n=r[0],i=r[1];return e[0]=t[0]*n+t[2]*i+t[4],e[1]=t[1]*n+t[3]*i+t[5],e}function ft(e,r,t){var n=r[0],i=r[1];return e[0]=t[0]*n+t[3]*i+t[6],e[1]=t[1]*n+t[4]*i+t[7],e}function lt(e,r,t){var n=r[0],i=r[1];return e[0]=t[0]*n+t[4]*i+t[12],e[1]=t[1]*n+t[5]*i+t[13],e}function dt(e,r,t,n){var i=r[0]-t[0],a=r[1]-t[1],s=Math.sin(n),c=Math.cos(n);return e[0]=i*c-a*s+t[0],e[1]=i*s+a*c+t[1],e}function ut(e,r){var t=e[0],n=e[1],i=r[0],a=r[1],s=Math.sqrt(t*t+n*n)*Math.sqrt(i*i+a*a),c=s&&(t*i+n*a)/s;return Math.acos(Math.min(Math.max(c,-1),1))}function vt(e){return e[0]=0,e[1]=0,e}function pt(e){return"vec2("+e[0]+", "+e[1]+")"}function mt(e,r){return e[0]===r[0]&&e[1]===r[1]}function Mt(e,r){var t=e[0],n=e[1],i=r[0],a=r[1];return Math.abs(t-i)<=m*Math.max(1,Math.abs(t),Math.abs(i))&&Math.abs(n-a)<=m*Math.max(1,Math.abs(n),Math.abs(a))}var gt=ie,yt=K,xt=ee,wt=re,zt=te,$t=ne,Ct=ae,Tt=function(){var e=Z();return function(r,t,n,i,a,s){var c,h;for(t||(t=2),n||(n=0),i?h=Math.min(i*t+n,r.length):h=r.length,c=n;c<h;c+=t)e[0]=r[c],e[1]=r[c+1],a(e,e,s),r[c]=e[0],r[c+1]=e[1];return r}}();const Et=Object.freeze(Object.defineProperty({__proto__:null,add:Yr,angle:ut,ceil:Xr,clone:Nr,copy:kr,create:Z,cross:at,dist:zt,distance:te,div:wt,divide:re,dot:it,equals:Mt,exactEquals:mt,floor:Jr,forEach:Tt,fromValues:_r,inverse:tt,len:gt,length:ie,lerp:st,max:Wr,min:Hr,mul:xt,multiply:ee,negate:rt,normalize:nt,random:ct,rotate:dt,round:Zr,scale:Kr,scaleAndAdd:et,set:Qr,sqrDist:$t,sqrLen:Ct,squaredDistance:ne,squaredLength:ae,str:pt,sub:yt,subtract:K,transformMat2:ht,transformMat2d:ot,transformMat3:ft,transformMat4:lt,zero:vt},Symbol.toStringTag,{value:"Module"}));class A{constructor(r,t){this.update=()=>{},this.name=r,this.parent=t}}const C=e=>e*Math.PI/180,se=e=>{const r=Math.pow(10,e-1),t=Math.pow(10,e)-1;return Math.floor(Math.random()*(t-r+1))+r};class ce extends A{constructor(r){super("CameraComponent",r),this.update=()=>{this.forwards=[Math.cos(C(this.parent.transformComponent.eulers[2]))*Math.cos(C(this.parent.transformComponent.eulers[1])),Math.sin(C(this.parent.transformComponent.eulers[2]))*Math.cos(C(this.parent.transformComponent.eulers[1])),Math.sin(C(this.parent.transformComponent.eulers[1]))],L(this.right,this.forwards,[0,0,1]),L(this.up,this.right,this.forwards);let t=$();P(t,new Float32Array(this.parent.transformComponent.position),this.forwards),Ce(this.view,new Float32Array(this.parent.transformComponent.position),t,this.up)},this.getView=()=>this.view,this.view=G(),this.forwards=$(),this.right=$(),this.up=$()}}var b=(e=>(e[e.QUAD=0]="QUAD",e[e.TRIANGLE=1]="TRIANGLE",e[e.OBJECT=2]="OBJECT",e))(b||{});class q{constructor(){this.initialized=!1,this.initialize=r=>{this.initialized||(this.bufferUsageFlags=GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,this.bufferDescriptor={size:this.verticies.byteLength,usage:this.bufferUsageFlags,mappedAtCreation:!0},this.buffer=r.createBuffer(this.bufferDescriptor),new Float32Array(this.buffer.getMappedRange()).set(this.verticies),this.buffer.unmap(),this.bufferLayout={arrayStride:20,attributes:[{shaderLocation:0,format:"float32x3",offset:0},{shaderLocation:1,format:"float32x2",offset:12}]},this.initialized=!0)}}}class he extends q{constructor(){super(),this.v=[],this.vt=[],this.vn=[]}async setup(r,t){await this.readFile(t),this.verticieCount=this.verticies.length/5,this.setupBuffer(r)}async readFile(r){const i=(await(await fetch(r)).text()).split(`
`),a=[];i.forEach(s=>{const c=s.trim().split(/\s+/);switch(c[0]){case"v":this.readVertexLine(c);break;case"vt":this.readTextCoordLine(c);break;case"vn":this.readNormalLine(c);break;case"f":this.readFaceLine(c,a);break}}),this.verticies=new Float32Array(a)}readVertexLine(r){const t=[parseFloat(r[1]),parseFloat(r[2]),parseFloat(r[3])];this.v.push(t)}readTextCoordLine(r){const t=[parseFloat(r[1]),parseFloat(r[2])];this.vt.push(t)}readNormalLine(r){const t=[parseFloat(r[1]),parseFloat(r[2]),parseFloat(r[3])];this.vn.push(t)}readFaceLine(r,t){r.slice(1).forEach(n=>{this.readCorner(n,t)})}readCorner(r,t){const[n,i,a]=r.split("/").map(h=>parseInt(h,10)-1),s=this.v[n],c=this.vt[i];!s||!c||t.push(s[0],s[1],s[2],c[0],c[1])}setupBuffer(r){this.buffer=r.createBuffer({size:this.verticies.byteLength,usage:GPUBufferUsage.VERTEX,mappedAtCreation:!0}),new Float32Array(this.buffer.getMappedRange()).set(this.verticies),this.buffer.unmap()}}const w=class w{constructor(){}static async initialize(r){if(w.instance){console.warn("Renderer is already initialized.");return}w.adapter=r,w.instance=await this.adapter.requestDevice()}static getInstance(){if(!w.instance)throw new Error("Device is not initialized. Call initialize() first.");return w.instance}};w.instance=null;let B=w;class oe extends q{constructor(r){super(),this.verticies=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,.5,.5,0,1,1,-.5,.5,0,0,1,-.5,-.5,0,0,0]),this.verticieCount=6,this.initialize(r)}}class fe extends q{constructor(r){super(),this.verticies=new Float32Array([0,0,.5,.5,0,0,-.5,-.5,0,1,0,.5,-.5,1,1]),this.verticieCount=3,this.initialize(r)}}class S extends A{constructor(r,t,n){super("MeshComponent",r),this.update=()=>{this.model=G(),O(this.model,this.model,this.parent.transformComponent.position),O(this.model,this.model,this.parent.transformComponent.position),we(this.model,this.model,C(this.parent.transformComponent.eulers[2]))},this.setupMesh=async()=>{const i=B.getInstance();switch(this.meshType){case b.OBJECT:if(!this.objectUrl)throw new Error("ObjectURL not specified when creating object mesh.");const a=new he;await a.setup(i,this.objectUrl),this.mesh=a;break;case b.QUAD:this.mesh=new oe(i);break;case b.TRIANGLE:this.mesh=new fe(i);break;default:throw new Error("Invalid MeshType specified.")}},this.getModel=()=>this.model,this.getMesh=()=>this.mesh,this.meshType=t,this.objectUrl=n}}class At{constructor(r){this.update=()=>{let n=0;this.gameObjects.forEach(i=>{i.components.forEach(a=>{if(a.update(),a instanceof S){const s=a.getModel();for(let c=0;c<16;c++)this.objectData[16*n+c]=s.at(c);n++}})}),this.camera.update()},this.getCamera=()=>this.camera,this.getObjectData=()=>({viewTransform:this.camera.getView(),modelTransforms:this.objectData}),this.addGameObject=n=>{this.gameObjects.push(n)},this.getGameObjects=()=>this.gameObjects;const t=r.getComponent(ce);if(!t)throw new Error("Camera component not found within gameobject specified.");this.camera=t,this.gameObjects=[],this.objectData=new Float32Array(16*1024),this.gameObjects.push(r)}}const le=`struct TransformData {
    view: mat4x4<f32>,
    projection: mat4x4<f32>
};

struct ObjectData {
    model: array<mat4x4<f32>>,
};

@binding(0) @group(0) var<uniform> transformUBO: TransformData;
@binding(1) @group(0) var<storage, read> objects: ObjectData;

@binding(0) @group(1) var myTexture: texture_2d<f32>;
@binding(1) @group(1) var mySampler: sampler;

struct Fragment {
    @builtin(position) Position : vec4<f32>,
    @location(0) TexCoord: vec2<f32>
};

@vertex
fn vs_main(
    @builtin(instance_index) id: u32, 
    @location(0) vertexPosition: vec3<f32>, 
    @location(1) vertexTexCoord: vec2<f32>) -> Fragment {

    var output : Fragment;
    output.Position = transformUBO.projection * transformUBO.view * objects.model[id] * vec4<f32>(vertexPosition, 1.0);
    output.TexCoord = vertexTexCoord;
    return output;
};

@fragment
fn fs_main(@location(0) TexCoord : vec2<f32>) -> @location(0) vec4<f32> {
    return textureSample(myTexture, mySampler, TexCoord);
};`,x=class x{constructor(){}static async initialize(r){if(x.instance){console.warn("Renderer is already initialized.");return}x.canvas=r,x.instance=new ue(r)}static getInstance(){if(!x.instance)throw new Error("Renderer is not initialized. Call initialize() first.");return x.instance}};x.instance=null,x.canvas=null;let T=x;class de extends A{constructor(r,t){super("MaterialComponent",r),this.setMaterial=n=>{const a=T.getInstance().materials.filter(s=>s.url==n);if(a.length>1)throw new Error("Multiple instances of same material url found. Please remove duplicates.");this.material=a[0]},this.setMaterial(t)}}class ue{constructor(r){this.addTexture=t=>{this.materials.push(t)},this.initialize=async()=>{await this.setupDevice(),await this.createBindGroupLayouts(),await this.createAssets(),await this.createDepthBufferResources(),await this.createPipeline(),await this.createBindGroup()},this.setupDevice=async()=>{this.adapter=await navigator.gpu.requestAdapter(),await B.initialize(this.adapter),this.device=B.getInstance(),this.context=this.canvas.getContext("webgpu"),this.format="bgra8unorm",this.context.configure({device:this.device,format:this.format,alphaMode:"opaque"})},this.createBindGroupLayouts=async()=>{this.frameGroupLayout=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{}},{binding:1,visibility:GPUShaderStage.VERTEX,buffer:{type:"read-only-storage"}}]}),this.materialGroupLayout=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,texture:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{}}]})},this.createAssets=async()=>{for(let n of this.materials)await n.initialize(this.device,n.url,this.materialGroupLayout),console.log(`Initialized material: ${n.url}`);this.uniformBuffer=this.device.createBuffer({size:64*2,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});const t={size:64*1024,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST};this.objectBuffer=this.device.createBuffer(t)},this.createDepthBufferResources=async()=>{this.depthStencilState={format:"depth24plus-stencil8",depthWriteEnabled:!0,depthCompare:"less-equal"};const n={size:{width:this.canvas.width,height:this.canvas.height,depthOrArrayLayers:1},format:"depth24plus-stencil8",usage:GPUTextureUsage.RENDER_ATTACHMENT};this.depthStencilBuffer=this.device.createTexture(n);const i={format:"depth24plus-stencil8",dimension:"2d",aspect:"all"};this.depthStencilView=this.depthStencilBuffer.createView(i),this.depthStencilAttachment={view:this.depthStencilView,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store",stencilLoadOp:"clear",stencilStoreOp:"discard"}},this.createPipeline=async()=>{const t=this.device.createPipelineLayout({bindGroupLayouts:[this.frameGroupLayout,this.materialGroupLayout]});this.pipeline=this.device.createRenderPipeline({vertex:{module:this.device.createShaderModule({code:le}),entryPoint:"vs_main",buffers:[{arrayStride:20,attributes:[{shaderLocation:0,format:"float32x3",offset:0},{shaderLocation:1,format:"float32x2",offset:12}]}]},fragment:{module:this.device.createShaderModule({code:le}),entryPoint:"fs_main",targets:[{format:this.format}]},primitive:{topology:"triangle-list"},layout:t,depthStencil:this.depthStencilState})},this.createBindGroup=async()=>{this.frameBindGroup=this.device.createBindGroup({layout:this.frameGroupLayout,entries:[{binding:0,resource:{buffer:this.uniformBuffer}},{binding:1,resource:{buffer:this.objectBuffer}}]})},this.startRender=async t=>{var l;this.activeScene=t;const n=t.getObjectData();if(!this.device)throw new Error("GPUDevice is not initialized.");const i=G();$e(i,Math.PI/4,800/600,.1,5e4);const a=n.viewTransform;this.device.queue.writeBuffer(this.objectBuffer,0,n.modelTransforms,0,n.modelTransforms.length),this.device.queue.writeBuffer(this.uniformBuffer,0,a),this.device.queue.writeBuffer(this.uniformBuffer,64,i);const s=this.device.createCommandEncoder(),c=this.context.getCurrentTexture().createView(),h=s.beginRenderPass({colorAttachments:[{view:c,clearValue:{r:.5,g:0,b:.25,a:1},loadOp:"clear",storeOp:"store"}],depthStencilAttachment:this.depthStencilAttachment});h.setPipeline(this.pipeline),h.setBindGroup(0,this.frameBindGroup);const f=t.getGameObjects();let o=0;for(const u of f){const d=u.getComponent(de),p=u.getComponent(S);if(!d||!p)continue;(l=p==null?void 0:p.mesh)!=null&&l.initialized||await p.setupMesh(),p.mesh.initialized=!0;const M=p.getMesh();M.buffer&&d.material&&(h.setVertexBuffer(0,M.buffer),h.setBindGroup(1,d.material.bindGroup),h.draw(M.verticieCount,1,0,o),o++)}h.end(),this.device.queue.submit([s.finish()])},this.canvas=r,this.materials=[]}}class bt{constructor(r){if(this.createRenderer=async()=>{this.rendererInitialized=T.initialize(this.canvas),await this.rendererInitialized,this.renderer=T.getInstance()},this.getRenderer=async()=>(await this.rendererInitialized,this.renderer),this.validateActiveScene=()=>!0,this.startRenderProcess=async()=>{await this.rendererInitialized,await this.renderer.initialize(),requestAnimationFrame(this.gameLoop)},this.gameLoop=async()=>{if(!this.activeScene)throw new Error("No current active scene was set.");this.activeScene.update(),await this.rendererInitialized,this.renderer.startRender(this.activeScene),requestAnimationFrame(this.gameLoop)},!r)throw new Error("Improper canvas specificed in initializing engine.");if(this.canvas=r,navigator.gpu)console.log("WebGPU supported, started to run engine.");else throw new Error("WebGPU is not supported on this browser.");this.createRenderer()}get activeScene(){return this._activeScene}set activeScene(r){this._activeScene=r}}class ve extends A{constructor(r){super("TransformComponent",r),this.position=[0,0,0],this.eulers=$(),this.eulers[2]=0}}class Bt{constructor(r){this.name=r,this.instanceId=se(10),this.components=[],this.transformComponent=new ve(this)}getComponent(r){for(const t of this.components)if(t instanceof r)return t;return null}addComponent(r){for(const t of this.components)if(t.name==r.name)return console.error("Trying to add duplicate component with same name."),null;return this.components.push(r),r}}class qt{constructor(r){if(this.initialize=async(n,i,a)=>{const c=await(await fetch(i)).blob(),h=await createImageBitmap(c);this.loadImageBitmap(n,h);const f={format:"rgba8unorm",dimension:"2d",aspect:"all",baseMipLevel:0,mipLevelCount:1,baseArrayLayer:0,arrayLayerCount:1};this.view=this.texture.createView(f);const o={addressModeU:"repeat",addressModeV:"repeat",magFilter:"linear",minFilter:"nearest",mipmapFilter:"nearest",maxAnisotropy:1};this.sampler=n.createSampler(o);const l=n.createBindGroup({layout:a,entries:[{binding:0,resource:this.view},{binding:1,resource:this.sampler}]});this.bindGroup=l},this.loadImageBitmap=async(n,i)=>{const a={size:{width:i.width,height:i.height},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT};this.texture=n.createTexture(a),n.queue.copyExternalImageToTexture({source:i},{texture:this.texture},a.size)},this.url=r,T.getInstance().materials.filter(n=>n.url==r).length!==0)throw new Error("Material with image already found, please use existing material.")}}v.BaseComponent=A,v.CameraComponent=ce,v.Deg2Rad=C,v.EpicEngine=bt,v.GameObject=Bt,v.Material=qt,v.MaterialComponent=de,v.Mesh=q,v.MeshComponent=S,v.MeshTypes=b,v.ObjectMesh=he,v.QuadMesh=oe,v.Renderer=ue,v.Scene=At,v.TransformComponent=ve,v.TriangleMesh=fe,v.generateId=se,v.vec2=Et,v.vec3=hr,v.vec4=Vr,Object.defineProperty(v,Symbol.toStringTag,{value:"Module"})});
